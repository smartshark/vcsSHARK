# check if tests succeed
sudo: required
language: python
python:
  - "3.6"

services:
  - mongodb

before_install:
  - printenv | grep -E '^TRAVIS_' > .env
  - wget https://github.com/libgit2/libgit2/archive/v0.26.2.tar.gz
  - tar xzf v0.26.2.tar.gz
  - cmake libgit2-0.26.2/
  - make
  - sudo make install
  - sudo apt-get install -y build-essential wget git
  - sudo apt-get install -y python3-pip python3-cffi
  - pip install -U pip setuptools
  - pip install Sphinx
  - pip install sphinx_rtd_theme
  - pip install ghp_import

install:
  - python setup.py install

script:
  - python setup.py test

after_success:
  - make deploy > /dev/null

deploy:
  provider: releases
  api_key: ${TRAVIS_GH_TOKEN}
  file: "vcsSHARK_plugin.tar"
  skip_cleanup: true
  on:
    repo: smartshark/vcsSHARK
    tags: true